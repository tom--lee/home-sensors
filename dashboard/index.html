<!DOCTYPE html>

<meta charset="UTF-8">

<html>

<head>
  <title>Current Time</title>
  <style>
    body {
      color: #e36464;
      background-color: black;
    }

    #time {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      font-size: 20vw;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: "Consolas", "Courier New", monospace;
      font-weight: 500;
    }

    #bom-temperature {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 50%;
      height: 50%;
      font-size: 10vw;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: "Consolas", "Courier New", monospace;
      font-weight: 500;
    }

    #temperature {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50%;
      height: 50%;
      font-size: 10vw;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: "Consolas", "Courier New", monospace;
      font-weight: 500;
    }
  </style>
</head>

<body>
  <span id="time"></span>
  <span id="temperature"></span>
  <span id="bom-temperature"></span>

  <script>

    const host = "ampere.local"
    const port = "8000"

    //import  {pad} from pad

    function format_time(time) {
      const hours24 = time.getHours()
      const hours = hours24 % 12
      const formatted_hours = (hours === 0 ? 12 : hours).toString().padStart(2, ' ');
      const formatted_minutes = time.getMinutes().toString().padStart(2, '0');
      return formatted_hours + ":" + formatted_minutes
    }

    function update_time() {
      // Get the current time
      const current_time = new Date();
      const text = format_time(current_time);
      // Set the time in the span element
      document.getElementById("time").innerHTML = text;
    }

    // Call the function once to display the time immediately
    update_time();

    // Update the time every second
    setInterval(update_time, 1000);


    //import  {pad} from pad

    function format_temperature(temperature) {
      return temperature + "Â°C"
    }

    async function get_sensor_data(locationId) {
      const url = host
      const response = await fetch(`${locationId}/latest`)
      if (!response.ok) {
        return response.status
      }
      const responseBody = await response.text();
      console.log(responseBody)
      return JSON.parse(responseBody);
    }

    async function get_bom_temperature() {
      const bomEndpoint = "http://www.bom.gov.au/fwo/IDN60801/IDN60801.94729.json"
      const response = await fetch(bomEndpoint, { mode: "no-cors" })
      if (!response.ok) {
        return response.status
      }
      const responseJson = await response.json()
      return responseJson.observations.data[0].air_temp
    }

    async function update_temperature() {
      // Get the current time
      const temperature = (await get_sensor_data('living-room')).temperature
      if (typeof (temperature) !== "number") {
        console.log("no temperature reading " + temperature)
        return
      }

      const text = format_temperature(temperature);
      // Set the time in the span element
      document.getElementById("temperature").innerHTML = text;
    }

    async function update_bom_temperature() {
      // Get the current time
      const temperature = await get_bom_temperature()
      if (typeof (temperature) !== "number") {
        console.log("no temperature reading " + temperature)
        return
      }

      const text = format_temperature(temperature);
      // Set the time in the span element
      document.getElementById("bom-temperature").innerHTML = text;

    }

    // Call the function once to display the time immediately
    update_temperature();

    // Update the temperature every minute
    setInterval(update_bom_temperature, 60000);
    setInterval(update_temperature, 10000);
  </script>
</body>

</html>